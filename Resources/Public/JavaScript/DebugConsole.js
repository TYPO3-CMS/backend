/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","jquery"],(function(t,e,n){"use strict";var o=new(function(){function t(){var t=this;this.settings={autoscroll:!0},n((function(){t.createDom()}))}return t.incrementInactiveTabCounter=function(t){if(!t.hasClass("active")){var e=t.find(".badge"),n=parseInt(e.text(),10);isNaN(n)&&(n=0),e.text(++n)}},t.prototype.add=function(e,o,s){this.attachToViewport();var a=n("<p />").html(e);void 0!==o&&o.length>0&&a.prepend(n("<strong />").text(o)),void 0!==s&&0!==s.length||(s="Debug");var l="debugtab-"+s.toLowerCase().replace(/\W+/g,"-"),i=this.$consoleDom.find(".t3js-debuggroups"),r=this.$consoleDom.find(".t3js-debugcontent"),c=this.$consoleDom.find(".t3js-debuggroups li[data-identifier="+l+"]");0===c.length&&(c=n("<li />",{role:"presentation","data-identifier":l}).append(n("<a />",{"aria-controls":l,"data-toggle":"tab",href:"#"+l,role:"tab"}).text(s+" ").append(n("<span />",{class:"badge"}))).on("shown.bs.tab",(function(t){n(t.currentTarget).find(".badge").text("")})),i.append(c),r.append(n("<div />",{role:"tabpanel",class:"tab-pane",id:l}).append(n("<div />",{class:"t3js-messages messages"})))),0===i.find(".active").length&&i.find("a:first").tab("show"),t.incrementInactiveTabCounter(c),this.incrementUnreadMessagesIfCollapsed();var d=n("#"+l+" .t3js-messages"),p=d.parent().hasClass("active");d.append(a),this.settings.autoscroll&&p&&d.scrollTop(d.prop("scrollHeight"))},t.prototype.createDom=function(){var t=this;void 0===this.$consoleDom&&(this.$consoleDom=n("<div />",{id:"typo3-debug-console"}).append(n("<div />",{class:"t3js-topbar topbar"}).append(n("<p />",{class:"pull-left"}).text(" TYPO3 Debug Console").prepend(n("<span />",{class:"fa fa-terminal topbar-icon"})).append(n("<span />",{class:"badge"})),n("<div />",{class:"t3js-buttons btn-group pull-right"})),n("<div />").append(n("<div />",{role:"tabpanel"}).append(n("<ul />",{class:"nav nav-tabs t3js-debuggroups",role:"tablist"})),n("<div />",{class:"tab-content t3js-debugcontent"}))),this.addButton(n("<button />",{class:"btn btn-default btn-sm "+(this.settings.autoscroll?"active":""),title:TYPO3.lang["debuggerconsole.autoscroll"]}).append(n("<span />",{class:"t3-icon fa fa-magnet"})),(function(){n(t).button("toggle"),t.settings.autoscroll=!t.settings.autoscroll})).addButton(n("<button />",{class:"btn btn-default btn-sm",title:TYPO3.lang["debuggerconsole.toggle.collapse"]}).append(n("<span />",{class:"t3-icon fa fa-chevron-down"})),(function(e){var o=n(e.currentTarget),s=o.find(".t3-icon"),a=t.$consoleDom.find(".t3js-topbar").next();a.toggle(),a.is(":visible")?(o.attr("title",TYPO3.lang["debuggerconsole.toggle.collapse"]),s.toggleClass("fa-chevron-down",!0).toggleClass("fa-chevron-up",!1),t.resetGlobalUnreadCounter()):(o.attr("title",TYPO3.lang["debuggerconsole.toggle.expand"]),s.toggleClass("fa-chevron-down",!1).toggleClass("fa-chevron-up",!0))})).addButton(n("<button />",{class:"btn btn-default btn-sm",title:TYPO3.lang["debuggerconsole.clear"]}).append(n("<span />",{class:"t3-icon fa fa-undo"})),(function(){t.flush()})).addButton(n("<button />",{class:"btn btn-default btn-sm",title:TYPO3.lang["debuggerconsole.close"]}).append(n("<span />",{class:"t3-icon fa fa-times"})),(function(){t.destroy(),t.createDom()})))},t.prototype.addButton=function(t,e){return t.on("click",e),this.$consoleDom.find(".t3js-buttons").append(t),this},t.prototype.attachToViewport=function(){var t=n(".t3js-scaffold-content");0===t.has(this.$consoleDom).length&&t.append(this.$consoleDom)},t.prototype.incrementUnreadMessagesIfCollapsed=function(){var t=this.$consoleDom.find(".t3js-topbar");if(t.next().is(":hidden")){var e=t.find(".badge"),n=parseInt(e.text(),10);isNaN(n)&&(n=0),e.text(++n)}},t.prototype.resetGlobalUnreadCounter=function(){this.$consoleDom.find(".t3js-topbar").find(".badge").text("")},t.prototype.flush=function(){var t=this.$consoleDom.find(".t3js-debuggroups"),e=this.$consoleDom.find(".t3js-debugcontent");t.children().remove(),e.children().remove()},t.prototype.destroy=function(){this.$consoleDom.remove(),this.$consoleDom=void 0},t}());return TYPO3.DebugConsole=o,o}));