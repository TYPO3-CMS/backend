/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","jquery","TYPO3/CMS/Backend/Storage/Client","bootstrap","TYPO3/CMS/Backend/jquery.clearable"],(function(e,o,t,i){"use strict";return new(function(){function e(){this.ready=!0,this.options={error:".t3js-login-error",errorNoCookies:".t3js-login-error-nocookies",errorNoReferrer:".t3js-login-error-noreferrer",formFields:".t3js-login-formfields",interfaceField:".t3js-login-interface-field",loginForm:"#typo3-login-form",loginUrlWrapper:"t3js-login-url",submitButton:".t3js-login-submit",submitHandler:null,useridentField:".t3js-login-userident-field"},this.checkCookieSupport(),this.checkForInterfaceCookie(),this.checkDocumentReferrerSupport(),this.initializeEvents(),top.location.href!==location.href&&(this.ready=!1,top.location.href=location.href),this.ready&&document.body.setAttribute("data-typo3-login-ready","true")}return e.prototype.showLoginProcess=function(){this.showLoadingIndicator(),t(this.options.error).addClass("hidden"),t(this.options.errorNoCookies).addClass("hidden")},e.prototype.showLoadingIndicator=function(){t(this.options.submitButton).button("loading")},e.prototype.handleSubmit=function(e){this.showLoginProcess(),"function"==typeof this.options.submitHandler&&this.options.submitHandler(e)},e.prototype.interfaceSelectorChanged=function(){var e=new Date,o=new Date(e.getTime()+31536e6);document.cookie="typo3-login-interface="+t(this.options.interfaceField).val()+"; expires="+o.toUTCString()+";"},e.prototype.checkForInterfaceCookie=function(){if(t(this.options.interfaceField).length){var e=document.cookie.indexOf("typo3-login-interface=");if(-1!==e){var o=document.cookie.substr(e+22);o=o.substr(0,o.indexOf(";")),t(this.options.interfaceField).val(o)}}},e.prototype.checkDocumentReferrerSupport=function(){var e="1"===i.get("referrerRefresh"),o=document.getElementById(this.options.loginUrlWrapper);null!==o&&void 0!==o.dataset.referrerCheckEnabled&&"1"===o.dataset.referrerCheckEnabled&&("string"!=typeof document.referrer||""===document.referrer?e?document.querySelectorAll(this.options.errorNoReferrer).forEach((function(e){return e.classList.remove("hidden")})):(this.ready=!1,i.set("referrerRefresh","1"),o.click()):e&&i.unset("referrerRefresh"))},e.prototype.showCookieWarning=function(){t(this.options.formFields).addClass("hidden"),t(this.options.errorNoCookies).removeClass("hidden")},e.prototype.hideCookieWarning=function(){t(this.options.formFields).removeClass("hidden"),t(this.options.errorNoCookies).addClass("hidden")},e.prototype.checkCookieSupport=function(){var e=navigator.cookieEnabled;!1===e?this.showCookieWarning():document.cookie||null!==e||(document.cookie="typo3-login-cookiecheck=1",document.cookie?document.cookie="typo3-login-cookiecheck=; expires="+new Date(0).toUTCString():this.showCookieWarning())},e.prototype.initializeEvents=function(){t(document).ajaxStart(this.showLoadingIndicator.bind(this)),t(this.options.loginForm).on("submit",this.handleSubmit.bind(this)),t(this.options.interfaceField).length>0&&t(document).on("change blur",this.options.interfaceField,this.interfaceSelectorChanged.bind(this)),t(".t3js-clearable").clearable(),t(".t3js-login-news-carousel").on("slide.bs.carousel",(function(e){var o=t(e.relatedTarget).height();t(e.target).find("div.active").parent().animate({height:o},500)}))},e}())}));