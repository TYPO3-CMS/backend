/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","./Enum/Severity","jquery","./AjaxDataHandler","./InfoWindow","./Modal","./ModuleMenu","./Viewport"],(function(e,t,n,a,r,o,i,s,l){"use strict";return function(){function e(){}return e.getReturnUrl=function(){return top.rawurlencode(top.list_frame.document.location.pathname+top.list_frame.document.location.search)},e.editRecord=function(t,n){var r="",o=a(this).data("pages-language-uid");o&&(r="&overrideVals[pages][sys_language_uid]="+o),l.ContentContainer.setUrl(top.TYPO3.settings.FormEngine.moduleUrl+"&edit["+t+"]["+n+"]=edit"+r+"&returnUrl="+e.getReturnUrl())},e.viewRecord=function(e,t){var n=a(this).data("preview-url");n&&window.open(n,"newTYPO3frontendWindow").focus()},e.openInfoPopUp=function(e,t){o.showItem(e,t)},e.mountAsTreeRoot=function(e,t){"pages"===e&&l.NavigationContainer.PageTree.setTemporaryMountPoint(t)},e.newPageWizard=function(t,n){l.ContentContainer.setUrl(top.TYPO3.settings.NewRecord.moduleUrl+"&id="+n+"&pagesOnly=1&returnUrl="+e.getReturnUrl())},e.newContentWizard=function(t,r){var o=a(this),s=o.data("new-wizard-url");s&&(s+="&returnUrl="+e.getReturnUrl(),i.advanced({title:o.data("title"),type:i.types.ajax,size:i.sizes.medium,content:s,severity:n.SeverityEnum.notice}))},e.newRecord=function(t,n){l.ContentContainer.setUrl(top.TYPO3.settings.FormEngine.moduleUrl+"&edit["+t+"][-"+n+"]=new&returnUrl="+e.getReturnUrl())},e.openHistoryPopUp=function(t,n){l.ContentContainer.setUrl(top.TYPO3.settings.RecordHistory.moduleUrl+"&element="+t+":"+n+"&returnUrl="+e.getReturnUrl())},e.openListModule=function(e,t){var n="pages"===e?t:a(this).data("page-uid");s.App.showModule("web_list","id="+n)},e.pagesSort=function(e,t){var n=a(this).data("pages-sort-url");n&&l.ContentContainer.setUrl(n)},e.pagesNewMultiple=function(e,t){var n=a(this).data("pages-new-multiple-url");n&&l.ContentContainer.setUrl(n)},e.disableRecord=function(t,n){var r=a(this).data("disable-field")||"hidden";l.ContentContainer.setUrl(top.TYPO3.settings.RecordCommit.moduleUrl+"&data["+t+"]["+n+"]["+r+"]=1&redirect="+e.getReturnUrl()).done((function(){l.NavigationContainer.PageTree.refreshTree()}))},e.enableRecord=function(t,n){var r=a(this).data("disable-field")||"hidden";l.ContentContainer.setUrl(top.TYPO3.settings.RecordCommit.moduleUrl+"&data["+t+"]["+n+"]["+r+"]=0&redirect="+e.getReturnUrl()).done((function(){l.NavigationContainer.PageTree.refreshTree()}))},e.deleteRecord=function(e,t){var o=a(this);i.confirm(o.data("title"),o.data("message"),n.SeverityEnum.warning,[{text:a(this).data("button-close-text")||TYPO3.lang["button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",name:"cancel"},{text:a(this).data("button-ok-text")||TYPO3.lang["button.delete"]||"Delete",btnClass:"btn-warning",name:"delete"}]).on("button.clicked",(function(n){"delete"===n.target.getAttribute("name")&&r.process("cmd["+e+"]["+t+"][delete]=1").done((function(){if("pages"===e&&l.NavigationContainer.PageTree){if(t===top.fsMod.recentIds.web){var n=l.NavigationContainer.PageTree.instance.nodes[0];l.NavigationContainer.PageTree.selectNode(n)}l.NavigationContainer.PageTree.refreshTree()}}));i.dismiss()}))},e.copy=function(t,n){var r=TYPO3.settings.ajaxUrls.contextmenu_clipboard+"&CB[el]["+t+"%7C"+n+"]=1&CB[setCopyMode]=1";a.ajax(r).always((function(){e.triggerRefresh(l.ContentContainer.get().location.href)}))},e.clipboardRelease=function(t,n){var r=TYPO3.settings.ajaxUrls.contextmenu_clipboard+"&CB[el]["+t+"%7C"+n+"]=0";a.ajax(r).always((function(){e.triggerRefresh(l.ContentContainer.get().location.href)}))},e.cut=function(t,n){var r=TYPO3.settings.ajaxUrls.contextmenu_clipboard+"&CB[el]["+t+"%7C"+n+"]=1&CB[setCopyMode]=0";a.ajax(r).always((function(){e.triggerRefresh(l.ContentContainer.get().location.href)}))},e.triggerRefresh=function(e){-1===e.indexOf("record%2Fedit")&&l.ContentContainer.refresh(!0)},e.clearCache=function(e,t){var n=top.TYPO3.settings.WebLayout.moduleUrl+"&id="+t+"&clear_cache=1";a.ajax(n)},e.pasteAfter=function(t,n){e.pasteInto.bind(a(this))(t,-n)},e.pasteInto=function(t,r){var o=a(this),s=function(){var n="&CB[paste]="+t+"%7C"+r+"&CB[pad]=normal&redirect="+e.getReturnUrl();l.ContentContainer.setUrl(top.TYPO3.settings.RecordCommit.moduleUrl+n).done((function(){"pages"===t&&l.NavigationContainer.PageTree&&l.NavigationContainer.PageTree.refreshTree()}))};o.data("title")?i.confirm(o.data("title"),o.data("message"),n.SeverityEnum.warning,[{text:a(this).data("button-close-text")||TYPO3.lang["button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",name:"cancel"},{text:a(this).data("button-ok-text")||TYPO3.lang["button.ok"]||"OK",btnClass:"btn-warning",name:"ok"}]).on("button.clicked",(function(e){"ok"===e.target.getAttribute("name")&&s(),i.dismiss()})):s()},e}()}));