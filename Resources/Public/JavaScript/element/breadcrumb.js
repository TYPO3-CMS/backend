/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{LitElement as b,html as i,render as c,nothing as u}from"lit";import{property as h,customElement as f}from"lit/decorators.js";import{classMap as p}from"lit/directives/class-map.js";import g from"@typo3/backend/module-menu.js";import{InputTransformer as v}from"@typo3/core/ajax/input-transformer.js";import"@typo3/backend/element/icon-element.js";import"bootstrap";var m=function(d,e,t,r){var s=arguments.length,n=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(d,e,t,r);else for(var l=d.length-1;l>=0;l--)(o=d[l])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n};let a=class extends b{constructor(){super(...arguments),this.nodes=[],this.alignRight=!1,this.label="Breadcrumb",this.collapsedNodes=[],this.dropdownButtonWidth=null,this.measurementContainer=null}connectedCallback(){super.connectedCallback(),this.identifier=Date.now().toString(36)+Math.random().toString(36).slice(2),this.resizeObserver=new ResizeObserver(()=>this.adjustBreadcrumb()),this.resizeObserver.observe(this)}disconnectedCallback(){this.resizeObserver.disconnect(),super.disconnectedCallback()}createRenderRoot(){return this}async willUpdate(e){e.has("nodes")&&(await this.createMeasurementContainer(),await this.measureDropdownToggle(),await this.measureNodeWidths())}render(){const e=this.nodes.filter(t=>!this.collapsedNodes.includes(t));return i`<nav class="breadcrumb breadcrumb-collapsible${this.alignRight?" breadcrumb-right":""}" aria-label=${this.label}>${this.collapsedNodes.length>0?i`<div class="breadcrumb-item dropdown" role=presentation>${this.renderDropdownToggle()}<div class=dropdown-menu>${this.collapsedNodes.map(t=>this.renderDropdownItem(t))}</div></div>`:null} ${e.map(t=>{const r=p({"breadcrumb-item":!0,"breadcrumb-item-first":this.isFirstNode(t),"breadcrumb-item-last":this.isLastNode(t)});return i`<div class=${r} role=presentation>${this.renderBreadcrumbElement(t)}</div>`})}</nav>`}async createMeasurementContainer(){this.measurementContainer===null&&(this.measurementContainer=document.createElement("div"),this.measurementContainer.classList.add("breadcrumb-measurement"),this.measurementContainer.ariaHidden="true",this.measurementContainer.style.position="absolute",this.measurementContainer.style.visibility="hidden",this.measurementContainer.style.pointerEvents="none",this.measurementContainer.style.width="auto",this.measurementContainer.style.whiteSpace="nowrap",this.renderRoot.appendChild(this.measurementContainer))}async measureDropdownToggle(){if(this.dropdownButtonWidth===null){const e=i`<div class="breadcrumb-item dropdown">${this.renderDropdownToggle()}</div>`;c(e,this.measurementContainer);const t=this.measurementContainer.querySelector("div");this.dropdownButtonWidth=t?.offsetWidth??0,c(u,this.measurementContainer)}}async measureNodeWidths(){const e=this.nodes,t=this.nodes.map(s=>{if(s.__width)return s;const n=i`<div class=${p({"breadcrumb-item":!0,"breadcrumb-item-first":this.isFirstNode(s),"breadcrumb-item-last":this.isLastNode(s)})} role=presentation>${this.renderBreadcrumbElement(s)}</div>`;c(n,this.measurementContainer);const l=this.measurementContainer.querySelector("div")?.offsetWidth??0;return c(u,this.measurementContainer),{...s,__width:l}});!this.areNodeCollectionsEqual(e,t)&&(this.nodes=t)}async adjustBreadcrumb(){const e=this.renderRoot?.querySelector(".breadcrumb");if(!e)return;this.collapsedNodes=[];let r=this.nodes[this.nodes.length-1]?.__width||0;for(const s of this.nodes.slice(0,-1).reverse())e.clientWidth>r+this.dropdownButtonWidth+s.__width?r+=s.__width:this.collapsedNodes.push(s);this.collapsedNodes.reverse(),this.requestUpdate()}renderDropdownToggle(){return i`<button type=button id=breadcrumb-toggle-${this.identifier} class=breadcrumb-element aria-haspopup=true aria-expanded=false data-bs-toggle=dropdown>...</button>`}renderDropdownItem(e){return e.route!==null?i`<button type=button class=dropdown-item title=${e.label} @click=${t=>this.triggerAction(t,e)}>${this.renderIcon(e)} <span class=dropdown-item-label>${e.label}</span></button>`:i`<div class=dropdown-item title=${e.label}>${this.renderIcon(e)} <span class=dropdown-item-label>${e.label}</span></div>`}renderBreadcrumbElement(e){return e.route!==null?i`<button type=button class=breadcrumb-element title=${e.label} aria-current=${this.isLastNode(e)?"page":"false"} @click=${t=>this.triggerAction(t,e)}>${e.forceShowIcon||this.isLastNode(e)?this.renderIcon(e):u} <span class=breadcrumb-element-label>${e.label}</span></button>`:i`<div class=breadcrumb-element title=${e.label} aria-current=${this.isLastNode(e)?"page":"false"}>${this.isLastNode(e)?this.renderIcon(e):u} <span class=breadcrumb-element-label>${e.label}</span></div>`}renderIcon(e){return e.icon?i`<typo3-backend-icon identifier=${e.icon} overlay=${e.iconOverlay} size=small></typo3-backend-icon>`:null}triggerAction(e,t){const r=new URLSearchParams(v.toSearchParams(t.route.params)).toString();g.App.showModule(t.route.module,r,e)}isFirstNode(e){return this.nodes[0]===e}isLastNode(e){return this.nodes[this.nodes.length-1]===e}areNodeCollectionsEqual(e,t){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!this.areNodesEqual(e[r],t[r]))return!1;return!0}areNodesEqual(e,t){return e.identifier===t.identifier&&e.label===t.label&&e.icon===t.icon&&e.iconOverlay===t.iconOverlay&&e.__width===t.__width}};m([h({type:Array})],a.prototype,"nodes",void 0),m([h({type:Boolean})],a.prototype,"alignRight",void 0),m([h({type:String})],a.prototype,"label",void 0),a=m([f("typo3-breadcrumb")],a);export{a as Breadcrumb};
